<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta http-equiv="X-UA-Compatible" content="IE=edge">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Angry Birds</title>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.17.1/matter.min.js"></script>
 <script src="matter.js"></script>
 <style>
 canvas {
 position: relative;
 border: 1px solid black;
 background-color: white;
 }
 </style>
</head>
<body onload="init()" onload="StartAngryBord()">
 <div id="areaToRender">
 </div>
 <div>

 </div>


<script>

var score = 0;
var bords = 5;
let height = window.innerHeight - 65;
let width = window.innerWidth - 35;

let Engine = Matter.Engine,
 Render = Matter.Render,
 Runner = Matter.Runner,
 Bodies = Matter.Bodies,
 Composite = Matter.Composite,
 Composites = Matter.Composites,
 Constraint = Matter.Constraint,
 Mouse = Matter.Mouse,
 MouseConstraint = Matter.MouseConstraint,
 Events = Matter.Events;
 Detector = Matter.Detector;
 let engine;
let render;
let runner;

function init() {

 // create an engine
 engine = Engine.create();

 // create a renderer
 render = Render.create({
 element: document.getElementById("areaToRender"),
 engine: engine,
 options: {
 width: (window.innerWidth - 35),
 height: (window.innerHeight - 65),
 pixelRatio: 1,
 background: '#fafafa',
 wireframes: false // <-- important
 }
 });

 
 // run the renderer
 Render.run(render);

 // create runner
 runner = Runner.create();

 // run the engine
 Runner.run(runner, engine);

 myTimeout = setTimeout(StartAngryBord(), 300);
}

let lastClear = "(not given)"
function clearWorld(exampleName) {
 if (lastClear != exampleName) {
 lastClear = exampleName

 Matter.Composite.clear(engine.world, false)
 }
}

setInterval(function() {
    refresh()
}, 50)



function refresh() {



        document.getElementById("bordsLeft").innerHTML = bords;

        document.getElementById("score").innerHTML = Math.round(score);

        checkGameOver();

        

 

   

}

function checkGameOver() {
    if (bords == 0) {
        gameOver();
    }
}

function gameOver() {
    setTimeout (function() {
        alert("Game Over, your score is: " + Math.round(score) + ", you suck");
        window.refresh();
    }, 5000);
}


function StartAngryBord() {
 clearWorld("AngryBord")



 // add bodies
 var ground = Bodies.rectangle(600, 600, 1000, 50, { isStatic: true, render: { strokeStyle: '#ffffff', sprite: { texture: './woodFloor2.png'  } } }),
        rockOptions = { density: 0.004, render: { strokeStyle: '#ffffff', sprite: { texture: './bord.png'  } }, restitution: 0.8},
        rock = Bodies.polygon(70, 450, 50, 10, rockOptions ),
        anchor = { x: 70, y: 450 },
        elastic = Constraint.create({ 
            pointA: anchor, 
            bodyB: rock, 
            stiffness: 0.01,
            render: { strokeStyle: 'gray', lineWidth: 2 }
        });
        rock.label = 'rock';

    var pinsOptions1 = { label: 'pig1', render: { strokeStyle: '#ffffff', sprite: { texture: './porky.png'  } } };
    var pinsOptions2 = { label: 'pig2', render: { strokeStyle: '#ffffff', sprite: { texture: './porky.png'  } } };
    var pinsOptions3 = { label: 'pig3', render: { strokeStyle: '#ffffff', sprite: { texture: './porky.png'  } } };
    var trianglesOptions = {angle: 1.5708, render: { fillStyle: '#B57300'}, isStatic: true };

    ////////////////world design and enemies/////////////
   
        var wall01 = Bodies.rectangle(400, 0, 1000, 50, { isStatic: true, render: { fillStyle: '#B57300',  } });

        var wall02 = Bodies.polygon(950, 525, 3, 100, trianglesOptions);

        var wall03 = Bodies.rectangle(600, 150, 10, 300, { isStatic: true, render: { fillStyle: '#B57300',  } });

        var wall04 = Bodies.rectangle(600, 300, 300, 10, { isStatic: true, render: { fillStyle: '#B57300',  } });

        var wall05 = Bodies.rectangle(950, 450, 10, 1000, { isStatic: true, render: { fillStyle: '#B57300',  } });

        var wall06 = Bodies.trapezoid(400, 600, 100, 50, 0.5, { isStatic: true, render: { fillStyle: '#B57300',  } });

        var pigG01 = Composites.pyramid(620, 248, 5, 5, 0, 0, function(x, y) {
            return Bodies.polygon(x, y, 8, 10, pinsOptions1);
        });

        var pigG02 = Composites.pyramid(500, 248, 5, 5, 0, 0, function(x, y) {
            return Bodies.polygon(x, y, 8, 10, pinsOptions2);
        });

        var pigG03 = Composites.pyramid(500, 520, 5, 5, 0, 0, function(x, y) {
            return Bodies.polygon(x, y, 8, 10, pinsOptions3);
        });





   /////////////////////////////////////////////////////

    Composite.add(engine.world, [ground, rock, elastic, wall01, wall02, wall03, wall04, wall05, wall06, pigG01, pigG02, pigG03]);
    Events.on(engine, 'afterUpdate', function() {
        if (mouseConstraint.mouse.button === -1 && (rock.position.x > 90 || rock.position.y < 430) && bords > 0) {

  
                rock = Bodies.polygon(70, 450, 50, 10, rockOptions);
                Composite.add(engine.world, rock);
                elastic.bodyB = rock;
                bords = bords - 1;


        
        }
/////////////////////////////////////////   collision detection for score   /////////////////////////////////////////

Events.on(engine, 'collisionStart', function(event) {
    var pairs = event.pairs;

    for (var i = 0, j = pairs.length; i != j; ++i) {
        var pair = pairs[i];

        if ((pair.bodyA.label === 'rock' && (pair.bodyB.label === 'pig1' || pair.bodyB.label === 'pig2')) || 
            ((pair.bodyA.label === 'pig1' || pair.bodyA.label === 'pig2') && pair.bodyB.label === 'rock')) {
            // Increase the score by 1
            score = score + 0.01;
            break;
        }
    }
});

Events.on(engine, 'collisionEnd', function(event) {
    var pairs = event.pairs;

    for (var i = 0, j = pairs.length; i != j; ++i) {
        var pair = pairs[i];

        if ((pair.bodyA.label === 'rock' && pair.bodyB.label === 'pig') || 
            (pair.bodyA.label === 'pig' && pair.bodyB.label === 'rock')) {
            // Increase the score by 1
            score = score;
            break;
        }
    }
});

    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////

     

    });


  // add mouse control
    var mouse = Mouse.create(render.canvas),
        mouseConstraint = MouseConstraint.create(engine, {
            mouse: mouse,
            constraint: {
                stiffness: 0.2,
                render: {
                    visible: false
                }
            }
        });
 

    Composite.add(engine.world, mouseConstraint);

    // keep the mouse in sync with rendering
    render.mouse = mouse;

    // fit the render viewport to the scene
    Render.lookAt(render, {
        min: { x: 0, y: 0 },
        max: { x: 800, y: 600 }
    });
  }

</script>


<button onclick="StartAngryBord()">Start Game</button>

<div id="bordsLeft">...</div>

<div id="score">0</div>
</body>
</html>
